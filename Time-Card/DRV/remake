set -euo pipefail

DIST="$(awk -F= '/^NAME/{print tolower($2)}' /etc/os-release|awk 'gsub(/[" ]/,x) + 1')"

KVER=`uname -r`

if [ "$DIST" == "ubuntu" ]; then
   KDIR=/usr/src/linux-headers-${KVER}
fi

if [ "$DIST" == "centoslinux" ] || [ "$DIST" == "centosstream" ]; then
   KDIR=/usr/src/kernels/${KVER}
fi

make -C $KDIR M=$PWD

ln -sf ${PWD}/ptp_ocp.ko /lib/modules/${KVER}
depmod -a

